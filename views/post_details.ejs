<%- include header.ejs %>

<style media="screen">
  .post_wrapper{
    background: #f8f8f8;
    margin: 30px 10px;
  }
  .comment_wrapper{
    background: #f5ebeb;
    margin: 30px 10px 0 10px;
    padding:20px;
  }
  .sub_comment_wrapper{
    background: #f3d5d5;
    margin: 5px 10px 5px 60px;
    padding:20px;
  }
</style>
<div class="container">
    <h1>Post Details</h1>

    <div class="row post_wrapper">
        <div class="col-md-12">
          <a href="javascript:void(0);"><h3><%= post_details.title %></h3></a>
          <p><%= post_details.description %></p>
          <span class="label label-default"><%= post_details.username %></span>
          <span class="label label-info"><%= post_details.comments_count %> Comments</span>
          <span class="label label-info"><%= post_details.likes_count %> Likes</span>
          <% if(post_details.my_like_status){ %>
          <span class="label label-default">You Liked</span>
          <% } else { %>
          <a href="javascript:void(0);" data-id="<%= post_details._id %>" class="label label-success like_post">Like</a>
          <% } %>
          <a href="javascript:void(0);" class="label label-warning post-comment-btn" data-parentid="0" data-toggle="modal" data-target="#commentModal">Post Comment</a>
        </div>
    </div>

    <h4>Comments:</h4>

    <% if(comments.length > 0){ comments.forEach(function(el, index) { %>
    <div class="row comment_wrapper">
      <div class="col-md-12">
        <p><%= el.message %></p>
        <span class="label label-default"><%= el.username %></span>
        <span class="label label-info"><%= el.likes_count %> Likes</span>
        <% if(el.my_like_status){ %>
        <span class="label label-default">You Liked</span>
        <% } else { %>
        <a href="javascript:void(0);" data-id="<%= el._id %>" class="label label-success like_comment">Like</a>
        <% } %>
        <a href="javascript:void(0);" class="label label-warning post-comment-btn" data-parentid="<%= el._id %>" data-toggle="modal" data-target="#commentModal">Reply Comment</a>
      </div>
    </div>

    <% if(el.sub_comments.length > 0){ el.sub_comments.forEach(function(sel, sindex) { %>
    <div class="row sub_comment_wrapper">
      <div class="col-md-12">
        <p><%= sel.message %></p>
        <span class="label label-default"><%= sel.username %></span>
        <span class="label label-info"><%= sel.likes_count %> Likes</span>
        <% if(sel.my_like_status){ %>
        <span class="label label-default">You Liked</span>
        <% } else { %>
        <a href="javascript:void(0);" data-id="<%= sel._id %>" class="label label-success like_comment">Like</a>
        <% } %>
      </div>
    </div>
    <% }); } %>


    <% }); } %>

</div>

<!-- Modal -->
<div id="commentModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <form action="/posts/post-comment" method="post" class="post-comment-form">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Post Comment</h4>
        </div>
        <div class="modal-body">
          <input type="hidden" name="post_id" value="<%= post_details._id %>" />
          <input type="hidden" name="parent_id" value="" />
          <textarea name="message" rows="8" cols="80" class="form-control" required></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-success post-comment">Submit</button>
        </div>
      </form>
    </div>

  </div>
</div>

<%- include footer.ejs %>
